name: Auto Update on Changes

on:
  push:
    branches: [ main, master, develop ]
    paths:
      - 'src/**'
      - 'package.json'
      - 'tsconfig.json'
      - '.github/workflows/**'
  schedule:
    # Run daily at 2 AM UTC to check for updates
    - cron: '0 2 * * *'

jobs:
  check-updates:
    name: Check for Updates
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Check for dependency updates
        run: |
          echo "Checking for dependency updates..."
          npm outdated || true
      
      - name: Build and verify
        run: |
          npm ci
          npm run build
          echo "âœ… Build successful after changes"

  notify-changes:
    name: Notify on Changes
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    
    steps:
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v40
        with:
          files: |
            src/**
            package.json
            tsconfig.json
      
      - name: Summary of changes
        run: |
          echo "## ðŸ“ Changes Detected" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** ${{ github.ref }}" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**Author:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Changed Files:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          git diff --name-only ${{ github.event.before }} ${{ github.sha }} >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

